<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Coin Collector!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            text-align: center;
            overflow: hidden;
            background-color: green;
        }
    </style>

    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>

<body>
    <script type="module">
        const gemz = new PIXI.Application({
            width: window.innerWidth,
            height: window.innerHeight,
            antialias: true,
            transparent: false,
            resolution: 1,
            backgroundColor: 0x262d41,
            autoDensity: true
        });

        let type = "WebGL"

        if (!PIXI.utils.isWebGLSupported()) {
            type = "canvas"
        }

        document.body.appendChild(gemz.view);

        const polyPoints = [
                (window.innerWidth / 2), -50, // top left
                (window.innerWidth / 2), -50, // top right
                window.innerWidth, window.innerHeight, // bottom right
                0, window.innerHeight // bottom left
            ];

        const floor = new PIXI.Graphics()
                .beginFill(0x22a6d7, 0.4)
                .drawPolygon(polyPoints)
                .lineStyle(100, 0xFF0000);

        floor.sortableChildren = true

        const backgroundTexture = PIXI.Texture.from('./assets/back.png');
        const background = new PIXI.Sprite(backgroundTexture);
        background.width = window.innerWidth;
        background.height = window.innerHeight;

        const bushTexture = PIXI.Texture.from('./assets/bush.png');
        const treeTexture = PIXI.Texture.from('./assets/tree.png');
        const playerTexture = PIXI.Texture.from('./assets/player.png');

        const player = new PIXI.Sprite(playerTexture);
        player.width = 100;
        player.height = 100;
        player.x = window.innerWidth / 2;
        player.y = window.innerHeight - 200;
        player.zIndex = 1

        document.addEventListener('keydown', e => {
            if (e.keyCode === 39 || e.keyCode === 68) {
                player.x = player.x + 30;
            }

            if (e.keyCode === 37 || e.keyCode === 65 || e.keyCode === 81) {
                player.x = player.x - 30;
            }
        })

        const objects = []

        window.setInterval(function () {
            let sprite = new PIXI.Sprite(bushTexture);
            sprite.zIndex = 1
            objects.push({
                x: (window.innerWidth / 2 + 40) - (Math.floor(Math.random() * 90) + 1),
                y: 0,
                height: 5,
                width: 5,
                sprite: sprite,
                direction: Math.floor(Math.random() * 2) + 1,
                xMovement: Math.floor(Math.random() * 3700) + 500,
                multiplier: 0,
                growBy: 0.4
            })
        }, 600);

        window.setInterval(function () {
            let sprite = new PIXI.Sprite(treeTexture);
            sprite.zIndex = 2
            objects.push({
                x: window.innerWidth / 2 - 100,
                y: -200,
                height: 10,
                width: 10,
                sprite: sprite,
                direction: Math.floor(Math.random() * 2) + 1,
                xMovement: Math.floor(Math.random() * 3700) + 500,
                multiplier: 0,
                growBy: 2
            })
        }, 2000);

        const ticker = gemz.ticker;
        
        ticker.add(delta => {
            objects.some((object, i) => {
                if(player.containsPoint(new PIXI.Point(object.x - 20, object.y - 20)) || object.sprite.containsPoint(new PIXI.Point(player.x - 20, player.y - 20))) {
                    player.visible = false
                    ticker.stop()
                }

                object.sprite.x = object.x
                object.sprite.y = object.y
                object.sprite.width = object.width
                object.sprite.height = object.height
                floor.addChild(object.sprite);

                object.y = object.y + 4 * object.multiplier;

                if(object.direction === 1){
                    object.x = object.x + (window.innerWidth / object.xMovement)  * object.multiplier
                }else{
                    object.x = object.x - (window.innerWidth / object.xMovement)  * object.multiplier
                }

                object.height = object.height + object.growBy;
                object.width = object.width + object.growBy;
                object.multiplier = object.multiplier + 0.01

                if(window.innerHeight < object.y) {
                    objects.splice(i, 1)
                }
            })
        });

        gemz.stage.addChild(background);
        gemz.stage.addChild(floor);
        gemz.stage.addChild(player);
    </script>
</body>

</html>